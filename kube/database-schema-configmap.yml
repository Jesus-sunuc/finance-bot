apiVersion: v1
kind: ConfigMap
metadata:
  name: database-schema
  namespace: finance-bot
data:
  schema.sql: |
    -- Database initialization script
    drop table if exists chat_messages cascade;

    drop table if exists agent_decision_log cascade;

    create table
        agent_decision_log (
            id serial primary key,
            user_message text not null,
            agent_state text not null,
            llm_reasoning text,
            action_taken text not null,
            result jsonb,
            created_at timestamp default current_timestamp
        );

    create table
        chat_messages (
            id serial primary key,
            user_id text not null,
            role text not null check (role in ('user', 'assistant')),
            content text not null,
            reasoning text,
            timestamp timestamp default current_timestamp,
            session_id text,
            metadata jsonb
        );

    create index idx_chat_messages_user_id on chat_messages (user_id);

    create index idx_chat_messages_timestamp on chat_messages (timestamp desc);

    create index idx_chat_messages_session on chat_messages (session_id);
